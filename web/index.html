<!DOCTYPE html>
<html>
<head>
    <title> Tic Tac Toe </title>
    <style type="text/css">
        table {
            width: 40%;
            border-collapse: collapse;
        }
        td {
            width: 33%;
            height: 33%;
            background-color: #f0f0f0;
            border: 6px solid #222;
            cursor: pointer;
        }
        td:after {
            content: "";
            display: block;
            margin-top: 100%;
        }
        td:first-of-type {
            border-left-color: transparent;
            border-top-color: transparent;
        }
        td:nth-of-type(2) {
            border-top-color: transparent;
        }
        td:nth-of-type(3) {
            border-right-color: transparent;
            border-top-color: transparent;
        }
        tr:nth-of-type(3) td {
            border-bottom-color: transparent;
        }

        td.o, td.x {
            cursor: default;
        }

        td.x {
            background-color: #cc3333;
        }
        td.o {
            background-color: #3333cc;
        }

    </style>
</head>
<body>
    <table>
        <tbody>
            <tr>
                <td onclick="c(1,this);"></td>
                <td onclick="c(2,this);"></td>
                <td onclick="c(3,this);"></td>
            </tr>
            <tr>
                <td onclick="c(4,this);"></td>
                <td onclick="c(5,this);"></td>
                <td onclick="c(6,this);"></td>
            </tr>
            <tr>
                <td onclick="c(7,this);"></td>
                <td onclick="c(8,this);"></td>
                <td onclick="c(9,this);"></td>
            </tr>
        </tbody>
    </table>
<script type="text/javascript">

let current_player = !1;

function c(i,e) {
    if(e.className == "") {
        e.className = current_player ? "o" : "x";
        current_player = !current_player;
    }
}

function getInput() {
    throw "NINGUÃ‰M";
}

function fim_de_jogo(n,p) {
    jogadas_vitoria = [[1,2,3],[4,5,6],[7,8,9],[1,4,7],[2,5,8],[3,6,9],[1,5,9],[3,5,7]];
    for(let i = 0, l = jogadas_vitoria.length; i < l; i++) {
        if((n.indexOf(jogadas_vitoria[i][0]) > -1
        && n.indexOf(jogadas_vitoria[i][1]) > -1
        && n.indexOf(jogadas_vitoria[i][2]) > -1)
        ||(p.indexOf(jogadas_vitoria[i][0]) > -1
        && p.indexOf(jogadas_vitoria[i][1]) > -1
        && p.indexOf(jogadas_vitoria[i][2]) > -1)
        ||(jogadas_jogador.length + jogadas_cpu.length >= 9))
            return true;
    }
    return false;
}

function desenhaJogo(desenha) {
    console.log("");
    console.log("",desenha[0],"|",desenha[1],"|",desenha[2]);
    console.log("-----------");
    console.log("",desenha[3],"|",desenha[4],"|",desenha[5]);
    console.log("-----------");
    console.log("",desenha[6],"|",desenha[7],"|",desenha[8]);
    console.log("");
}

function podevencer(n) {
    for(let i = 0, l = jogadas_vitoria.length; i < l; i++) {
        if(n.indexOf(jogadas_vitoria[i][0]) > -1
        && n.indexOf(jogadas_vitoria[i][1]) > -1
        && jogadas_jogador.indexOf(jogadas_vitoria[i][2]) == -1
        && jogadas_cpu.indexOf(jogadas_vitoria[i][2]) == -1) {
            return jogadas_vitoria[i][2];
        } else if(n.indexOf(jogadas_vitoria[i][0]) > -1
        && n.indexOf(jogadas_vitoria[i][2]) > -1
        && jogadas_jogador.indexOf(jogadas_vitoria[i][1]) == -1
        && jogadas_cpu.indexOf(jogadas_vitoria[i][1]) == -1) {
            return jogadas_vitoria[i][1];
        } else if(n.indexOf(jogadas_vitoria[i][1]) > -1
        && n.indexOf(jogadas_vitoria[i][2]) > -1
        && jogadas_jogador.indexOf(jogadas_vitoria[i][0]) == -1
        && jogadas_cpu.indexOf(jogadas_vitoria[i][0]) == -1) {
            return jogadas_vitoria[i][0];
        }
    }
    return 10;
}

function naodeixevencer(n) {
    for(let i = 0, l = jogadas_vitoria.length; i < l; i++) {
        if (n.indexOf(jogadas_vitoria[i][0]) > -1
        && n.indexOf(jogadas_vitoria[i][1]) > -1
        && jogadas_jogador.indexOf(jogadas_vitoria[i][2]) == -1
        && jogadas_cpu.indexOf(jogadas_vitoria[i][2]) == -1) {
            return jogadas_vitoria[i][2];
        } else if(n.indexOf(jogadas_vitoria[i][0]) > -1
        && n.indexOf(jogadas_vitoria[i][2]) > -1
        && jogadas_jogador.indexOf(jogadas_vitoria[i][1]) == -1
        && jogadas_cpu.indexOf(jogadas_vitoria[i][1]) == -1) {
            return jogadas_vitoria[i][1];
        } else if(n.indexOf(jogadas_vitoria[i][1]) > -1
        && n.indexOf(jogadas_vitoria[i][2]) > -1
        && jogadas_jogador.indexOf(jogadas_vitoria[i][0]) == -1
        && jogadas_cpu.indexOf(jogadas_vitoria[i][0]) == -1) {
            return jogadas_vitoria[i][0];
        }
    }
    return 10;
}

let jogadas_jogador = []
let jogadas_cpu = []
let fim = 0
let jogadas_vitoria = [[1,2,3],[4,5,6],[7,8,9],[1,4,7],[2,5,8],[3,6,9],[1,5,9],[3,5,7]]
let no_draw = 0
let allowed = 0
let nan = 1
let desenha = [' ',' ',' ',' ',' ',' ',' ',' ',' ']

while(fim==0) {
    console.log("1 -> jogador | 2 -> cpu\nQuem comeca?");
    while(nan==1) {
        decisao_ant = ~~getInput();
        if(decisao_ant < 10) {
            decisao = decisao_ant;
            nan = 0;
        } else {
            console.log("Nao entendi, repita por favor!");
        }
    }
    nan = 1;
    if(decisao == 1) {
        jogador_comeca = true;
        fim = 1;
    } else if(decisao == 2) {
        jogador_comeca = false;
        fim = 1;
    } else {
        console.log("Nao entendi, repita por favor!");
    }
}

let resolve = 0
while(fim_de_jogo(jogadas_jogador, jogadas_cpu) == false) {
    if(jogador_comeca == true || jogadas_jogador.length + jogadas_cpu.length > 0) {
        resolve = 1;
    }
    if(fim_de_jogo(jogadas_jogador, jogadas_cpu) == false) {
        while(allowed == 0 && resolve == 1) {
            while(nan==1) {
                temp_ant = ~~getInput("Jogador joga:\n");
                if(temp_ant < 10) {
                    temp = temp_ant;
                    nan = 0;
                } else {
                    console.log("Nao entendi, repita por favor!");
                }
            }
            nan = 1;
            if(jogadas_jogador.indexOf(temp) == -1
            && jogadas_cpu.indexOf(temp) == -1
            && temp > 0
            && temp < 10) {
                jogadas_jogador.push(temp);
                desenha[temp-1] = 'x';
                allowed = 1;
                desenhaJogo(desenha);
            } else {
                console.log("Nao entendi, repita por favor!");
            }
        }
        allowed = 0;
        if(fim_de_jogo(jogadas_jogador,jogadas_cpu) == false) {
            while(allowed == 0) {
                temp = podevencer(jogadas_cpu);
                if(jogadas_jogador.indexOf(temp) == -1
                && jogadas_cpu.indexOf(temp) == -1
                && temp > 0
                && temp < 10) {
                    jogadas_cpu.push(temp);
                    desenha[temp-1] = 'o';
                    allowed = 1;
                    desenhaJogo(desenha);
                } else {
                    temp = naodeixevencer(jogadas_jogador);
                    if(jogadas_jogador.indexOf(temp) == -1
                    && jogadas_cpu.indexOf(temp) == -1
                    && temp > 0
                    && temp < 10) {
                        jogadas_cpu.push(temp);
                        desenha[temp-1] = 'o';
                        allowed = 1;
                        desenhaJogo(desenha);
                    } else if((jogadas_jogador[0] == 1 && jogadas_jogador[1] == 9)
                    || (jogadas_jogador[0] == 9 && jogadas_jogador[1] == 1)
                    || (jogadas_jogador[0] == 3 && jogadas_jogador[1] == 7)
                    || (jogadas_jogador[0] == 7 && jogadas_jogador[1] == 3)) {
                        temp = 4;
                        jogadas_cpu.push(temp);
                        desenha[temp-1] = 'o';
                        allowed = 1;
                        desenhaJogo(desenha);
                    } else {
                        temp = 5;
                        if(jogadas_jogador.indexOf(temp) == -1
                        && jogadas_cpu.indexOf(temp) == -1
                        && temp > 0
                        && temp < 10) {
                            jogadas_cpu.push(temp);
                            desenha[temp-1] = 'o';
                            allowed = 1;
                            desenhaJogo(desenha);
                        } else {
                            ponta = [1,3,7,9];
                            repete = 0;
                            for(let i = 0, l = ponta.length; i < l; i++) {
                                if(jogadas_jogador.indexOf(ponta[i]) == -1
                                && jogadas_cpu.indexOf(ponta[i]) == -1
                                && repete == 0) {
                                    temp = ponta[i];
                                    repete = 1;
                                    jogadas_cpu.push(temp);
                                    desenha[temp-1] = 'o';
                                    allowed = 1;
                                    desenhaJogo(desenha);
                                }
                            }
                            if(repete==0) {
                                meio = [2,4,6,8];
                                for(let i = 0, l = meio.length; i < l; i++) {
                                    if(jogadas_jogador.indexOf(meio[i])== -1
                                    && jogadas_cpu.indexOf(meio[i]) == -1
                                    && repete == 0) {
                                        temp = meio[i];
                                        repete = 1;
                                        jogadas_cpu.push(temp);
                                        desenha[temp-1] = 'o';
                                        allowed = 1;
                                        desenhaJogo(desenha);
                                    }
                                }
                            }
                        }
                    }
                }
            }
            allowed = 0;
        }
    }
}


for(let i = 0, l = jogadas_vitoria.length; i < l; i++) {
    if(jogadas_cpu.indexOf(jogadas_vitoria[i][0])>-1
    && jogadas_cpu.indexOf(jogadas_vitoria[i][1])>-1
    && jogadas_cpu.indexOf(jogadas_vitoria[i][2])>-1) {
        console.log("Jogador venceu");
        no_draw = 1;
    } else if(jogadas_vitoria[i][0] in jogadas_cpu
    && jogadas_cpu.indexOf(jogadas_vitoria[i][1]>-1)
    && jogadas_cpu.indexOf(jogadas_vitoria[i][2])>-1) {
        console.log("CPU venceu");
        no_draw = 1;
    }
}
if(no_draw == 0) console.log("Deu velha");
</script>
</body>
</html>